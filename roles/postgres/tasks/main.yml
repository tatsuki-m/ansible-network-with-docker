---
- name: install postgresql
  apt: name={{ item }} state=latest
  with_items:
    - postgresql
    - postgresql-contrib
    - python-psycopg2

- name: postgresql initdb
  shell: service postgresql initdb

- name: start postgresql
  service: name=postgresql state=started enabled=yes

- name: postgres user sudores
  lineinfile:
    dest: /etc/sudoers.d/postgres
    owner: root
    group: root
    mode: 0440
    line: "{{ current_user }} ALL=(postgres) NOPASSWD: ALL"
    state: present
    create: yes
    validate: 'visudo -cf %s'

